# 数据查询使用指南

本指南介绍如何在应用中查看和理解自己的嗓音数据，以及如何浏览社区的公开汇总数据。内容覆盖：
- 公共仪表板（PublicDashboard）
- 个人仪表板中的事件时间轴（InteractiveTimeline）
- 事件管理器（EventManager）
- Timeline 模块的 AI 鼓励消息（AI 分析）说明

适用入口（已登录除外说明）：
- 公共仪表板：/dashboard（无需登录）
- 个人仪表板：/mypage（需登录）
- 事件管理：/event-manager（需登录）


一、公用数据：PublicDashboard（/dashboard）
- 概览卡片：显示“总记录事件数”“贡献用户数”。
- 用户列表：按照事件数量排序，点击“查看档案”会在右侧展开抽屉，展示该用户的公开资料（姓名、简介、社交信息，以其隐私设置为准）和其公开事件的明细与统计。
- 事件分布柱状图：按类别聚合。类别映射示例：
  - self_test 自我测试
  - hospital_test 医院检测
  - voice_training 嗓音训练
  - self_practice 自我练习
  - surgery VFS 手术
  - feeling_log 感受记录
- VFS 对齐的基频变化折线图：
  - 横轴是相对 VFS 手术日（记为第 0 天）的天数，纵轴为基频（Hz）。
  - 仅统计同时具备 VFS 事件与基频数据（details.fundamentalFrequency）的用户。
- 增强数据分析（EnhancedDataCharts）：
  - 提供多维度对齐、分组与趋势图，帮助比较训练 vs 非训练、VFS 分组后的差异与提升。
- 统计指标卡片：基于包含 VFS 的用户，计算 VFS 前后平均提升、方差和二倍方差，并显示参与统计的用户数。
- 常见状况：
  - 无数据时，图表会提示“无图表数据可用”。
  - 网络错误时可点“重试”。


二、个人数据：事件时间轴（InteractiveTimeline）
- 入口：/mypage 页面底部的“事件时间轴”区域。
- 视图自适配：
  - 移动端为纵向卡片列表。
  - 桌面端为横向时间轴，中央彩色轴线，事件以卡片与日期胶囊对齐显示。
- 事件类型标识：
  - 医院检测 🏥、自我测试 📱、嗓音训练 🎯、自我练习 ✍️、手术 ⚕️、感受记录 📝。
- 交互：点击任意事件卡片会弹出详情窗（居中模态）。
  - 详情内容会按事件类型展示常用字段（如地点、设备、声学参数等）。
  - 支持展示附件下载链接。如果附件名为 voice_test_report.pdf，会以“报告”样式突出显示（若后端已保存）。
- 排序：按事件日期/创建时间升序绘制，便于沿时间线追溯。
- 无数据时会提示“还没有事件记录”，可先前往“添加事件”。


三、事件管理：EventManager（/event-manager）
- 用途：对自己所有事件进行“筛选、搜索、排序、查看详情、删除”。
- 筛选与搜索：
  - 关键词搜索：在类型、备注（notes）、内容（content）等字段里匹配。
  - 类型过滤：从“全部类型”或具体类型中选择。若存在“未分类”事件，会额外提供过滤项。
  - 时间范围：全部、最近一周/一月/三月/半年。
- 排序：最新在前、最早在前、按类型排序。
- 统计条：显示各类型的数量徽章，便于快速了解分布。
- 事件列表：点击卡片打开详情弹窗；可在弹窗中查看字段与附件链接。
- 删除：在列表项右侧“删除”按钮可移除该事件（需确认），成功后会从列表中消失。
- 错误处理：加载失败会显示错误并提供“重试”。


四、Timeline 模块与 AI 鼓励消息（AI 分析）
- 模块说明：Timeline 组件包含“声音频率图表”“最近活动时间轴”和“AI 鼓励消息”。当前作为独立模块开发中，未来会整合到个人页。
- AI 鼓励消息：
  - 数据来源：会构造用户最近事件作为输入，通过后端接口获取一句鼓励/建议文案。
  - 触发逻辑：优先取最近 30 天事件；若 30 天内没有，则回退为全部可用事件；仍无数据时会显示默认文案“持续跟踪，持续进步 ✨”。
  - 状态表现：加载中有呼吸点动画；接口失败会写入日志并回退默认文案。
- 最近活动：会把事件按“今天 / 昨天 / 具体日期”分组显示，便于快速回顾。
- 频率图表：基于最近 10 条含基频的自测/医院测试事件绘制“声音频率（Hz）”折线图。


五、权限与环境
- 生产模式需要登录后访问 /mypage、/event-manager 等；/dashboard 公共可见。
- 开发模式可能会使用 mock 用户与 mock 数据，界面中“开发模式测试”模块仅在开发环境出现。
- 若看不到某些模块（如 AI 鼓励消息），可能仍在合并或受版本差异影响，可关注后续更新。


六、排障建议
- 数据为空：确认已添加过事件，或将时间范围切换为“全部时间”。
- 图表/时间轴异常：尝试刷新、重新登录，或在网络稳定环境下重试。
- 附件打不开：检查是否登录、链接是否过期；必要时从事件管理器重新进入事件详情。
