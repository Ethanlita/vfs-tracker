# 音阶练习使用指南

本指南介绍如何使用“音阶练习（ScalePractice）”完成热身、对位与音域测定。流程源自源码实现，步骤与界面一致。

入口与要求：
- 入口：/scale-practice（建议从 /mypage 点击“音阶练习”进入）
- 设备：需麦克风权限；建议佩戴耳机（避免外放回录干扰）


一、整体流程
- 权限与耳机检测 → 校准（找到舒适音高，根据用户声音状态自动调整判定门限和音准容忍限）→ 选择练习参数 → 演示一轮（可以跳过） → 正式爬升 → 正式下降 → 结果展示

二、权限与耳机检测
1) 打开页面后会自动请求麦克风权限；成功后按钮出现“进入耳机检测”。
2) 耳机检测：系统会测环境噪声与播放 1kHz 参考音，判断是否有外放回录。
   - 若检测通过，进入“校准”。
   - 若提示“似乎未佩戴耳机”，可“重试”或选择“继续”（可用但建议佩戴耳机以提升准确度）。

三、校准（找到合适起始音）
- 点击“开始录音”后，听到短促提示音，再以“舒适音高”持续发 /a/ 几秒。
- 系统会计算一个建议起始音（相对 C4 的半音偏移，范围 -12 ~ +12）。

四、设置与预听
- 选择练习模式：下拉框列出 `src/config/scaleModes.json` 中的模式，每个模式包含名称、简介、节拍结构与音阶序列；页面会显示本模式总拍数（示范/空拍/音符/收尾）。
- 选择练习音节：a、i、ne、mei、na（用于画面提示文案与音名显示，不影响检测门限）。
- 可拖动“起始音”滑条微调；点击“试听”播放当前起始音（采用钢琴音色）。
- 操作按钮：
  - “熟悉操作”：按当前模式演示一轮（拍数随模式变化），用于理解节拍与跟随方法；演示结束会给出提示文案。
  - “开始练习”：进入正式“爬升练习”。
- 预设模式示例：山形 12321、五音上行 12345、五音下行 54321、扩展小山 1234(1')、九度回转精简 123454、主和弦琶音 1-3-5-3-1、加高八度 1-3-5-8-5、三度级进/串联等，可在 JSON 中继续扩展。

五、练习节拍与指示器说明
- 每轮拍数由模式定义：通常包含示范拍、若干空拍、模式音符拍、收尾空拍。示例：基础 12321 模式为 1 示范 + 1 空拍 + 5 音符 + 1 收尾，共 8 拍；八度模式会更长。
- 画面包含两个关键指示：
  - 节拍指示器：按总拍数渲染小圆点，当前拍会高亮；下方文字会显示“第 X/N 拍 + 当前要求”，N 由模式计算。
  - 音高指示器：左侧纵向标尺根据模式最低/最高偏移动态设定，显示目标音允许区间（粉色带），中线为目标中心频率；你的实时 F0 以小圆点显示。

六、爬升与下降
1) 爬升练习（ascending）
- 从起始音出发，目标顺序由所选模式的 `patternOffsets` 决定（示范与正式一致）。
- 若在容差内（≈ ±50 cents）且稳定时间满足条件（≈ 300ms），判定当前轮“通过”，按模式的 `transposeStep` 自动移调进入下一轮。
- 若未通过，会显示失败提示（如“第 N 个音不够高/不够低/未检测到”），可“重试”或“开始下降练习”。

2) 下降练习（descending）
- 从爬升最后一轮的起始音往下降进行同样的拍数流程，音符序列仍由模式定义。
- 通过则把最低可控音刷新为更低值；失败可“重试”或“结束”。

七、结束与结果
- 点击“结束”或完成下降后，展示结果卡片：
  - 最高音与最低音（音名 + Hz）
  - 可视化键盘（C0-B8）：范围内的琴键高亮，直观看到音域覆盖
- 点击“返回”回到 /mypage。

八、实用建议与边界
- 环境与发声：选择安静房间，靠近麦克风；避免爆破音与剧烈气流。
- 佩戴耳机：显著降低外放回录干扰，提高检测稳定性。
- 容差与判定：系统采用能量与稳定性门限（能量阈、清晰度阈与连续稳定时长）以减少误检；演示仅给出提示，不影响成绩。
- 浏览器权限：若权限被拒绝或设备不可用，页面会报错，可在浏览器设置中重新授权后刷新。

九、常见问题
- “当前F0 为 0”或指示器不动：确认已持续发声且音量充足；靠近麦克风并避免环境噪声。
- “总是判定不够高/低”：先用“熟悉操作”，关注每拍的目标音；必要时降低或提高起始音再开始练习。
- 无法播放试音：检查系统音量与浏览器自动播放策略，尝试点击页面后再点“试听”。

