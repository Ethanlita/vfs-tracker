> 2025年12月10日更新

🎶 音阶练习迎来了一次史诗级的更新与加强！新增模式并修复了通过判定与节拍指示。

---

## 【🎵 新增练习模式】

* **大跨度山形 1-3-#5-3-1**：跨增五度的山形练习，适合扩大跨度。
* **五度音程 1-♭3-4-5-4-♭3-1**：多次触及纯五度，巩固咬字与口型。
* **八度音程 1-3-5-8-5-3-1**：八度跳跃往返，检查头胸声区衔接。
* **半音阶小山 1-♭2-2-♭2-1**：小跨度、半音与全音组合，方便术后音域较窄的用户循序渐进。
* **九度回转 123454321（16分音符版）**：与标准九度回转同音型，采用更短拍值加快往返，适合灵活度练习。

---

## 【🧭 练习流程优化】

* **开练前说明页**：音阶练习新增“说明与同意”页面，用户确认后才会申请麦克风权限，流程更可控。
* **难度分级排序**：练习模式按“入门/简单/一般/高级”自动排序，方便从易到难选择。
* **音域结果兜底**：下降轮次较少时，最低音至少回落到起始音的可达最低偏移，避免结果高于起点。

---

## 【📍 节拍进度指示】

* 音高指示器的小圆点现在会随节拍从左到右平滑移动，并在每一拍的中点经过对应拍的中心。
* 节拍长度不同也能正确对齐，便于跟随目标节拍。

---

> 2025年12月8日更新

---
## 【新用户向导问题修复】
自从上一次更新以后，有一部分用户（例如用户 `c4b83408-5071-70cb-7e1f-bb1a6beafec5`）在版本更新后会反复看到新用户的信息完善向导。现在我们已经完全解决了这个问题！

* **跳过按钮现在有效了**：点击"跳过设置"按钮后，系统现在会正确保存你的选择，不再强制进入向导。
* **问题根源**：原来是后端 Lambda 函数在保存用户资料时，没有保存 `setupSkipped` 标记字段，导致系统每次加载时都以为用户资料不完整。
* **技术细节**：
  - 修复了 `vfsTrackerUserProfileSetup` Lambda 函数，现在会正确保存 `setupSkipped: true` 标记
  - 更新了前端 Mock 处理器以支持测试该标记
  - 添加了 8 个新的单元测试，确保跳过流程正常工作

---

> 2025年12月3日更新-2

🔧 我们解决了一个长期存在的 SEO 和用户体验问题！现在直接访问任何页面都不会再看到"正在跳转..."的闪烁了。

---

## 【🌐 SPA 路由优化】

* **告别 404 闪烁**：以前直接访问 `/dashboard` 或其他非首页路径时，会先显示 GitHub Pages 的 404 页面，然后再跳转。现在通过 Cloudflare Worker 在边缘层处理 SPA 路由，页面会直接加载，无需跳转。
* **SEO 大幅改善**：所有页面现在都会返回正确的 HTTP 200 状态码，Google 爬虫终于可以正确索引我们的页面了！
* **新增 Sitemap**：为 Google 和其他搜索引擎提供了完整的站点地图（`/sitemap.xml`），帮助搜索引擎更好地发现和索引 VFS Tracker 的所有页面。

---

## 【🚫 真正的 404 页面】

* **友好的错误提示**：当你访问一个真正不存在的页面时，现在会看到一个设计精美的 404 页面，而不是被静默重定向到首页。
* **快捷导航**：404 页面提供了"返回首页"和"查看公共仪表板"两个快捷按钮，方便你快速找到正确的去处。
* **问题反馈入口**：如果你认为某个链接不应该是 404，可以直接点击链接向我们反馈。

---

## 【📋 开发者注意事项】

* 如果你是开发者或贡献者，请注意：**添加新路由时需要同步更新 Cloudflare Worker**。详见 `AGENTS.md` 和 `docs/cdn-architecture.md`。

---

> 2025年12月3日更新

🎨 我们对事件详情展示进行了全面的视觉升级！现在查看嗓音测试数据和各种事件记录时，你会看到更加清晰、美观的界面。

---

## 【📊 事件详情面板全新设计】

* **智能格式化显示**：所有数值现在都会自动带上正确的单位！基频显示为 `195.5 Hz`，时长显示为 `25.00 秒`，百分比显示为 `1.25%`，再也不用猜测数字的含义了。
* **字段名称中文化**：技术性的字段名（如 `f0_mean`、`jitter_percent`）现在会显示为易读的中文标签（平均基频、Jitter 百分比），更加友好直观。
* **按类型定制展示**：自测事件会以卡片网格的形式突出显示核心嗓音指标，手术事件会显示专门的医生/医院/日期信息卡片，每种事件类型都有最适合它的展示方式。
* **嵌套数据完整展示**：共振峰、音域范围、VRP 数据等复杂结构现在都能被正确解析和美观展示，不再显示难看的 JSON 格式。

---

## 【📝 AI 消息 Markdown 渲染】

* **代码高亮**：AI 回复中的代码块现在会以等宽字体显示，并带有浅色背景，更易阅读。
* **列表和引用**：AI 给出的建议列表、引用内容都会正确排版，不再是一堆纯文本挤在一起。
* **链接可点击**：AI 推荐的链接现在可以直接点击跳转。
* **整体体验提升**：与 AI 对话的界面现在看起来更像一个专业的对话助手了！

---

## 【📱 移动端分页优化】

* **事件列表分页**：手机端的事件列表现在支持分页浏览，每页显示 10 条记录，滑动更流畅。
* **清晰的分页信息**：底部会显示"显示 1 至 10，共 25 条"这样的统计信息，让你随时知道浏览进度。
* **简洁的翻页按钮**：上一页/下一页按钮设计简洁，适合单手操作。

---

## 【🧹 代码清理】

* 移除了 `InteractiveTimeline` 中 120+ 行的旧版事件详情渲染代码，统一使用新的组件系统。
* `EventManager` 的详情弹窗也升级使用了新组件，确保全站事件展示风格一致。
* 废弃了不再使用的 `EventList` 组件，精简了代码库。

---

> 2025年11月27日更新（基础设施即代码迁移完成）

🏗️ 我们完成了后端基础设施即代码（IaC）的全面迁移！这是一次重要的技术升级，虽然用户不会直接感知到变化，但这将极大提升我们的开发效率和系统可靠性。（这是今天的第二个更新）

---

## 【☁️ 后端资源全面纳入 CloudFormation 管理】

* **41 个资源纳入统一管理**：包括 16 个 Lambda 函数、3 个 DynamoDB 表、1 个 API Gateway，以及所有相关的权限配置
* **新建 API Gateway**：创建了由 CloudFormation 管理的新 API Gateway (`wg3q2nomc3`)，替代了原有的手动配置版本
* **自定义域名切换**：`api.vfs-tracker.app` 已成功切换到新的 API Gateway
* **Python 容器 Lambda**：`online-praat-analysis`（基于 Docker 的 Python 函数）也已纳入堆栈管理

---

## 【🚀 CI/CD 自动化部署】

* **GitHub Actions 工作流**：推送到 master 分支时自动触发后端部署
* **本地部署命令**：新增 `npm run deploy:backend` 一键部署后端
* **SAM 模板验证**：部署前自动验证模板语法，避免配置错误

---

## 【📋 开发工作流改进】

* **新增 Lambda 函数**：只需在 `lambda-functions/` 创建代码，然后更新 SAM 模板即可
* **新增 API 路由**：在 Lambda 的 Events 部分添加配置，SAM 自动创建所有相关资源
* **版本可追溯**：所有基础设施变更通过 Git 版本控制，可审计可回滚

---

## 【🔒 安全与稳定性】

* **终止保护**：CloudFormation 堆栈启用了终止保护，防止误删
* **DeletionPolicy: Retain**：数据库和存储资源设置为保留策略，即使堆栈删除也不会丢失数据
* **OIDC 认证**：GitHub Actions 使用 OIDC 临时凭证，无需存储长期密钥

---

> 这次迁移是 VFS Tracker 技术基础设施的重要里程碑。详细的技术文档请参阅 `infra/README.md`。

---

> 2025年11月27日更新

🎆 我们进行了一系列功能提升，这些东西是用户比较可以感知的。我们相信这将会提升用户体验。

---

## 【🔐 全新的独立登录页面】

* 现在告别弹窗式登录！现在所有登录操作都会跳转到专门的登录页面 `/login`，你大概率不会在看到之前那个超出父组件的登录框了。
* **无缝切换**：如果遇到问题，可以一键切换回传统的 Amplify 认证界面作为备选方案
* **所有入口统一**：无论是从顶栏点击"登录/注册"，还是访问需要登录的功能，都会跳转到统一的登录页面
* 此外，我们的登录页面现在换成中文的了，虽然我觉得英文大家应该也能看懂……大概？

---

## 【🚪 更智能的路由保护】

* **受保护的路由**现在会记住您想去的地方：
  - 当您未登录时访问需要认证的页面（如"我的页面"），系统会先引导您登录
  - 登录成功后会自动返回到您最初想访问的页面，而不是跳转到首页
* **首页功能区可点击**：未登录状态下，点击首页的"功能区"会引导您登录，登录后自动返回首页查看时间线
* **更流畅的导航体验**：所有需要登录的功能都会在点击时自动引导登录，无需手动寻找登录入口

---

## 【💜 VFS 记录提醒横幅】

* **贴心的数据记录提醒**：如果您只记录了嗓音测试数据，但还没有记录 VFS 手术事件本身，系统会显示一个紫色提醒横幅
* **提醒内容包括**：
  - 建议记录 VFS **手术前**的嗓音测试数据
  - 建议记录 VFS **手术事件**本身（日期和详情）
  - 建议定期记录手术后的嗓音测试数据
* **智能提醒策略**：
  - 可以随时关闭横幅
  - 关闭后会记住您的选择，一周内不会再次打扰
  - 如果已经记录了 VFS 相关事件，横幅会自动消失
* **为什么这很重要**：完整的 VFS 前后数据对比能够帮助您和我们更好地了解手术效果，为更多姐妹提供参考（之前大家都不是很主动进行记录呢，让我来push一下）

---

## 【🧭 侧栏导航优化】

* **在线时显示所有功能**：现在即使未登录，侧栏也会显示所有功能入口
* **智能跳转**：点击需要登录的功能时，系统会自动引导您登录，登录后返回原页面
* **离线友好**：断网时只显示离线可用的功能，避免误点击无法使用的功能

---

## 【🎤 嗓音测试朗读内容更新】

* 之前的朗读材料似乎很容易逗笑一部分用户，并且篇幅实在是太长了以致于用户不太可能在一分钟内读完。
* 我们现在换了一个诗歌，应该不那么容易把用户逗笑了，同时也缩短了篇幅。
* 感谢用户**橙子**提出这一建议！✨

---

> 2025年11月23日更新

这是一轮小更新。头像上传后终于能正常显示了，不会像之前那样由于404而显示一个错误图标。特别感谢用户芊酱第一时间汇报异常，才让我们找到bug。

---

## 【🖼️ 头像显示修复】
* 上传后的新头像会立刻同步到顶栏、个人资料和时间线，不会再出现“我明明换了头像但别人看不到”的尴尬。
* 头像加载流程现在只有唯一的正确路径，后台不会再偷偷帮你猜测旧图片位置，减少了各种玄学刷新。
* 如果暂时没有上传头像，系统会自动生成一张干净的默认风格图，不会再出现断链或灰色占位。
---

> 2025年11月20日更新（跨性别纪念日特别更新版）

🏳️‍⚧️ 作为一个特别版更新，让我们用一首诗歌开场，具体的更新内容将会紧随其后。

---

## 💌《第25小时的晨曦》

* 作者：丽塔

> 请不要盯着倒影里的裂痕  
> 便断言那是不可饶恕的错构  
> 我们并非造物主打盹时的笔误  
> 更非黑夜里 滋生出的荒谬  
> 我们只是比别人多花了一点时间  
> 才在灵魂的深处辨认出自己 真正的名字  
>     
> 收起那些廉价的自艾吧  
> 我们并不柔弱  
> 正如这世间所有如水般坚韧的姑娘  
> 能在大雨中奔跑，也能在悬崖边盛放  
> 眼泪与迷茫，是成长的必修课  
> 但请相信，我们的心脏同样为了爱与自由，滚烫地跳动着  
>      
> 即使这具躯壳 曾是错置的迷宫  
> 也请不要害怕  
> 看呐，这个时代早已点亮了火把  
> 那些精密的、闪着银光的理性与科技  
> 就是我们手中 能够修改星图的笔  
> 它能抹去错误的注脚  
> 将那原本就属于你的 柔美、细腻与长发  
> 一点一点，诚实地归还  
>      
> 哪怕前路曾被乌云封锁  
> 哪怕长夜 让人怀疑黎明的颜色  
> 但太阳从不会缺席  
> 它只是在等一个 最好的时刻  
>      
> 这世上，从来没有太晚的春天  
> 哪怕是在深秋苏醒  
> 那努力冲破茧房、笨拙却勇敢的样子  
> 就是这世间 最可爱的少女  
---
这是Amika给我布置的作业，但这也是我的感受。我们并不是怪人，也并不柔弱。我们和其他的女孩子没有区别，和她们一样能做到一切。也许需要多花一些时间和努力，但是我们拥有先进的医学，那些足以将一切修正的伟大创造。

也许你不会相信，或许那只是因为你处于焦虑和困境之中。但是，至少我如此坚信：改变，从来不晚；努力，就最可爱。

**这个纪念日或许没有多么值得高兴，不过，希望今天之后的每一天，你也能自信、强大、且幸福。**

---
（从这里开始是更新内容）
## 【🌐 SW架构更新】

* **PWA的修复**：以前的 Service Worker 是我手写的（捂脸），最初是可以正常运行的，但因为这个功能比较不常有，所以某次更新后损坏了也没被我发现。
* **拥抱标准**：现在我们全面迁移到了 `vite-plugin-pwa`。这是一个成熟的工业级解决方案，它会自动处理所有的缓存逻辑。
* **不再需要刷新**：之前每次git push后都会构建一个新的Service Worker，即使这个Service Worker没有任何变化，Actions也会为其注入一个新的版本号。为了确保更新版本，用户会在前端看到一个更新版本的提示。说实话，作为一个webapp，更新版本实在是太傻了。好在，之后你就不需要再更新版本了，因为我们通过更好的缓存策略确保了版本会在联网时自动更新。
* **体验升级**：
  * 更新检测更灵敏了，不会再让你卡在旧版本。
  * 离线支持更稳健了，静态资源和字体都会被正确缓存。
  * 虽然这只是底层的改变，但你会发现应用变得更“听话”了。

## 【🗑 废弃了过时的A/B测试】

* 我们在代码库里面删掉了一个过时的`NewTimeline` 组件——一个过时的A/B测试组件。
* 你不会感觉到有什么区别，不过，下次git clone的时候你可以少下载一点点东西了。



> 2025年11月16日更新

🎵 我们排期了很长时间的VFS效果预览功能来了！目前这个功能还比较naive，我们非常希望能得到你的建议！

---

## 【🎛️ 三种算法，任君选择】

* **RubberBand (专业级)**：来自音乐制作领域的业界标准库，采用 WebAssembly 版本在浏览器中高速运行。这是录音棚里用来修音高的那种级别！（目前还不是。因为算法的调试还不足）
* **WORLD Vocoder (高保真)**：日本 Morise 博士开发的 WORLD 声码器，在语音合成领域享有盛誉。它能精确分析和重建语音的基频、频谱包络和非周期性成分。
* **TD-PSOLA (轻量级)**：我们自己实现的时域音高同步重叠相加算法，轻巧快速，适合快速预览。

---

## 【🎯 对比播放，一目了然】

* 处理后的音频会分别保存三个版本，你可以随时切换播放对比
* 直观的音高变化显示：`143 Hz → 193 Hz (+50 Hz)`

---

> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 如果可以的话，把VFS Tracker介绍给别人吧！有更多的用户就意味着有更多的数据！
> 
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！

---

> 2025年11月11日更新

今年的双十一各位有买到什么喜欢的东西吗？有成功脱单吗？

反正我是既没有买到什么也没有成功脱单，非常失败了属于是。

虽然我很长时间没有在Github上面发布新的版本了，但我真的不是什么也没做！准确来说，我正在解决以前的屎山问题。过去一个月里，我完成了50多个commit的基础设施重构工作，虽然这些改进对用户来说是"看不见"的，但它们为未来的功能开发奠定了坚实的基础。

嗯，虽然其实只是我被毕业论文和面试疯狂双杀了。

---

## 【🏗️ 建立完整的测试体系】

* 实现了**三层防御体系**的测试架构：单元测试(Unit)、集成测试(Integration)和契约测试(Contract)，总计1056个测试用例，**100%通过率**，代码覆盖率达到52.62%
* 技术栈全面升级：采用Vitest作为测试运行器、React Testing Library用于组件测试、MSW(Mock Service Worker)实现网络级请求拦截
* 新增端到端(E2E)测试框架：基于Playwright搭建了6个完整的测试套件，覆盖67+测试场景，包括用户认证、事件管理、附件功能等核心流程
* 测试质量全面提升：修复了所有不稳定的测试、移除了硬编码的setTimeout、改用waitFor进行异步断言，确保测试的可靠性和可维护性

---

## 【📋 建立可执行的数据契约】

* 使用Joi建立了完整的Schema体系，覆盖User、Profile、Event(所有类型)、API Responses等所有数据结构
* Schema作为**单一真实来源**(Single Source of Truth)，确保Mock数据和真实API响应100%一致
* 实现了自动化的数据验证：所有API响应都会经过Schema验证，及时发现数据结构不匹配的问题
* 创建了完整的测试fixtures库：为complete-profile、minimal-profile、self-test、surgery等场景提供标准化的测试数据

---

## 【🚫 彻底废除运行时开发模式】

* 还记得上一个版本在页面底部的"生产模式"小绿灯吗？如果有人尝试clone过这个项目并在本地dev运行，就会发现VFS Tracker的另一面——开发模式
* 开发模式原本是为了快速验证前端设计而做出来的，但是随着项目规模的逐渐增加，对齐开发模式和生产模式的成本已经开始快速增加到难以负担的程度
* 现在我们已经**彻底废弃了运行时开发模式**，移除了所有`isProductionReady`和`globalIsProductionReady`相关代码，统一使用生产模式逻辑
* 所有的开发调试需求转向MSW mock server，既保证了开发效率，又避免了双重维护的成本

---

## 【📝 增加开源许可证】

* 作为一个开源项目，VFS Tracker居然到现在为止都没有一个许可证。这实在是不应该
* 我们现在对VFS Tracker通过**CC BY-NC-SA 4.0**协议授权，明确了使用条款：
  - ✅ 允许自由使用、修改和分享
  - ✅ 要求署名(Attribution)
  - ❌ 禁止商业使用(NonCommercial)
  - ✅ 衍生作品必须使用相同许可证(ShareAlike)
* 任何想要在现有代码基础上进一步开发的人现在有了法律依据，可以放心进行了

---

## 【🔧 代码质量的全面提升】

* 修复了全局污染问题：EventManager的实例不再泄漏到全局作用域
* 改进了错误处理：统一了ApiError和AppError的使用方式，建立了完整的错误处理规范(见`docs/error-handling-guide.md`)
* 测试稳定性优化：移除了所有不可靠的测试实践(如硬编码setTimeout、console.log断言等)
* 环境变量验证增强：在Amplify配置前验证所有必需的AWS环境变量，缺失时显示清晰的错误信息

---

## 【🎭 端到端测试框架搭建】

* 基于Playwright搭建了完整的E2E测试基础设施
* 添加了测试音频fixtures和详细的README文档，方便后续扩展

---

## 【📚 文档与规范的完善】

* 新增**AGENTS.md**: 为AI编程助手提供完整的项目约定和开发指南
* 更新**TESTING_GUIDE.md**: 详细说明测试编写规范、AAA模式、以及常见陷阱
* 新增**TESTING_ARCHITECTURE.md**: 阐述三层防御体系和Schema驱动开发的完整理念
* 新增**CONTRACT_TEST_ENVIRONMENT.md**: 说明契约测试的环境配置(重要：包含真实测试账户信息)

---

## 【💭 写在最后】

这次更新虽然没有添加新的用户可见功能，但这些"看不见"的基础设施工作是非常重要的：

* **测试体系**让我们可以放心地重构代码，不用担心破坏现有功能
* **数据契约**确保了前后端的数据格式始终一致，减少了因数据格式不匹配导致的bug
* **移除开发模式**简化了代码逻辑，让维护成本大幅降低
* **完善的文档**让新的贡献者能够快速了解项目规范

正如软件工程中常说的："偿还技术债务虽然不会立即带来新功能，但它会让未来的功能开发变得更快、更稳定"。

接下来我会继续优化CI/CD流程，将E2E测试集成到持续集成中，并开始着手实现一些新的功能特性！

---

> 2025年10月5日更新

全新的 Hz-音符转换工具已经上线，同时桌面端顶栏的“工具”菜单也正式与公共仪表板合并。

---

## 【🎼 新增 Hz-音符转换工具】

* 任何访客都可以直接使用 Hz ↔ 音名转换功能，并在 88 键钢琴上看到粉色高亮的结果。
* 在线状态自动加载钢琴 soundfont，离线状态回退为振荡器播放，兼容现有的 service worker。
* 针对手机等窄屏设备优化了横向滑动体验，保证随时都能找到目标琴键。

---

## 【🧰 顶栏入口调整】

* 电脑端顶栏新增“工具”下拉菜单，整合公共仪表板与 Hz-音符转换器等实用功能。
* 侧栏与「我的页面」同步增加了新的入口，方便快速跳转到转换工具。
* 实际上顶栏的下拉菜单是完全重构了！再也不会出现旧版本的抖动了！

---

> 2025年10月3日更新

今天的更新是一些屎山代码的处理。

---

## 【🧭 增加了到公共仪表板的NavLink】

* 现在登录后也会在上方看到公共仪表板的NavLink了。
* 对于已登录用户而言，不需要退出也能找到前往公共仪表板的按钮了。

---

## 【⚙️ 资料完善入口统一】

* 现在点击顶部横幅会直接进入引导式向导，不再弹出旧版的单页表单。
* 删除了重复的 ProfileSetup 组件和模态窗口，避免用户在不同入口看到不同界面。
* 向导现在使用与账号上下文一致的 `completeProfileSetup()` 来提交资料。
* 跳过功能暂时有问题，建议不要这么做。

---

## 【🧪 错误处理测试全面上线｜Error handling tests are now comprehensive】

* 新增 `node --test` 脚本自动跑通核心错误类型，覆盖 ApiError/AppError 及上传异常的关键场景。
* 测试同时验证上下文合并、请求 ID 捕获等细节，确保开发模式下的回退逻辑同样安全。

---

## 【📘 文档同步更新】

* README 与架构文档同步说明：缺少任一 AWS 关键环境变量都会被判定为开发模式。
* 记录必需变量列表（含 API Endpoint 与 S3 Bucket），方便部署时一次性核对。
* 新增根目录 AGENTS.md，写明“配置完整性”才会触发生产模式。
* 不再使用TODOList管理待办事项，转向issues。


---

> 2025年10月1日更新

🎉国庆快乐！我为VFS Tracker安排了一次小而重要的调整，让侧栏体验更加专注。

---

## 【🎯 侧栏入口更精简】

* 关闭了“公告”和“文档中心”两个入口，让日常使用中最常用的功能排在显眼位置。
* 精简后的导航更聚焦在录音、测试和个人资料等核心任务，减少首次打开时的信息量。
* 如果需要查阅公告或文档，也可以通过顶部导航或收藏的直达链接访问，不会受到影响。

---

## 【🧭 更新记录更好找】

* 保留了公告内容在“更新记录”中持续发布，你仍然可以在这里快速了解最新动态。
* 这一调整也让PWA的离线菜单更干净，方便你在断网时迅速找到真正可用的功能。

---

> 2025年9月30日更新

🚀我对VFS Tracker进行了一次重要的小修复，解决了PWA更新后页面可能重复刷新的问题！

---

## 【🔄更友好的PWA更新提示】

* 之前当Service Worker有新版本时，页面可能会自动刷新两次，让人有些摸不着头脑。
* 现在我们加入了一个更新横幅，当检测到新版本时会提示你选择刷新或稍后再说。
* 这样你可以在合适的时间刷新，不会被突如其来的自动刷新打断使用。

---

## 【🧭 首次登录引导更聪明】

* 收紧了“资料已完善”的判定条件，现在只有填写了真实姓名并确认隐私设置的新用户才会被认定为完成引导。
* 登录后会优先检查资料状态，只有在在线且确实需要完善资料时才会自动进入向导，避免离线情况下被强制跳转。
* 我们还把最近一次成功拉取的资料缓存到了本地，断网时会优先使用缓存内容而不是直接判定为未完善。

---

## 【📴 离线体验升级】

* 资料完善向导现在支持离线暂存，断网时点击完成会先保存到本地，等网络恢复后你可以再同步。
* 向导也新增了“先跳过”按钮，保证在离线场景下不会卡住。
* 侧栏会根据登录与否、在线状态自动隐藏需要认证或不适合离线访问的功能，让你在离线时只看到真正可用的入口。
* Service Worker 增强了脚本/样式/字体的缓存策略，公开页面访问过一次后离线再打开也能顺利加载。

---

> 2025年9月29日更新 （国庆节快乐特别版）

🌠我对VFS Tracker进行了一些更新！现在VFS Tracker又有了一些进步！

---

## 【☁️接入阿里云ESA】

* 今天凌晨我得到通知，ICP备案批准了！🎉于是VFS Tracker得以正式接入ESA（也就是说，中国大陆版本已经正式上线）

* ESA可以合法地穿越GFW，现在中国大陆所有地区的用户应该都可以正常使用了！（指中国大陆版）

* 如果在中国大陆使用vfs-tracker.app地址访问有问题，那么就改用vfs-tracker.cn吧！

---

## 【🛫大幅加快了页面加载速度】

* 原先的二重串行用户数据阻塞请求被改为了并行非阻塞请求，用户将不会再长时间看到烦人的“正在加载用户数据”界面。

* 我们还启用了缓存，这将会进一步加快用户的加载速度。

* 现在你应该可以很快地进入VFS Tracker的主界面，而无需进行烦人的长时间等待！

* 目前这一功能仍处于实验性阶段，虽然现阶段的测试功能正常，但是仍然存在出现脏读等问题的可能性。如果你发现数据有错乱，请清除缓存再试一次。（电脑上只需要同时按下 Ctrl/Cmd + Shift + R 即可）

---

## 【🌐PWA现在可以离线运行部分功能】

* 原先的PWA实际上根本没有一个真正的Service Worker，因此断网下将会彻底无法使用

* 新版本的Service Worker实现了一部分非联网功能，允许PWA用户在断网状态下使用“音阶练习”和“快速基频测试”功能。

* 一部分需要联网的feature不可使用，例如更好的钢琴音色、AI荐歌等。

* 如果你错过了第一次访问VFS Tracker时弹出的安装窗口，现在我们制作了一个安装按钮，你可以随时安装这个PWA到手机中。

* 这样子你就可以随时在不联网的情况下，进行一次无需等待的快速基频测试。我们希望这能让VFS Tracker更好地取代你手里的Voice Tools。

---

## 【📱手机端布局的改进】

* 原先VFS Tracker的布局完全没有为手机优化，这导致页面在手机上看起来总是很奇怪。

* 我们现在更新了顶栏的布局，把一部分功能收入了侧栏。这样顶栏将不会那么拥挤，布局也将会看起来正常许多！

---

## 【✅合规管理】

* 我们在中国大陆版本的下方加入了ICP备案信息

* 国际版增加了一个弹窗，如果你位于中国大陆地区并且感受到显著的访问速度问题，可以通过这个弹窗一键跳转中国大陆版

* 中国大陆版和国际版已经实现了数据互通

> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 如果可以的话，把VFS Tracker介绍给别人吧！有更多的用户就意味着有更多的数据！
> 
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！

---

> 2025年9月26日更新

🎉我刚刚对VFS Tracker进行了一些重大更新！相信这些更新将会大幅提升用户体验！

---

## 【🖥️现在VFS Tracker已经全量接入Cloudflare CDN】

* 不仅是页面本身，API和对象存储现在也会就近进入Cloudflare的边缘节点，然后通过高速CDN网络抵达服务器。

* 尽管Cloudflare CDN仍然属于跨境网络，但是其网络质量远好于直接连接位于us-east-1的访问点。

* api访问点由以前复杂的aws默认地址变成了api.vfs-tracker.app，对象存储访问点变成了storage.vfs-tracker.app，看起来变优雅了

* 现在在中国大陆地区的可用性应该得到了提升，除了部分存在“墙中墙”的地区，应该都可以通过vfs-tracker.app正常使用了。

---

## 【📊共振峰分析的史诗级加强】

* 原先的共振峰分析逻辑只会分析最高音和最低音，现在加入了对持续元音的分析。

* 实现了更加稳健的共振峰分析算法，除了会对每一帧实行置信度分析以防止噪声和无效片段干扰外，还会通过track和交叉验证来避免错误地识别到谐波，或者在某一共振峰缺失时错误地拿下一个共振峰顶上。

* 目前VFS Tracker的共振峰识别应该是所有开放产品中最准确的了！（其实也是其他的产品太少了以至于我可以挨个测试一遍）

---

## 【🐞一些bug的修复】

* 音域分析现在会合并分析你的多次测试，真的不会放过你的最佳表现了！

* MPT测试的录音文件选择bug已经修复，目前会选择真·发生时最长的文件，而不是录音时长最长的

---

## 【⭐一些其他的用户体验提升】

* 完整声音测试的主观量表允许跳过了，如果你不是很想写量表的话，现在可以跳过它

---

* 📑此外，我们还有一些接下来的开发计划 →

---

## 【☁️接入阿里云边缘安全加速ESA】

* Cloudflare仍然属于跨境访问，不能100%确保可用性，因此我们计划利用ESA再推出一个中国大陆版。

* ESA是合规的跨境加速器，可以合法穿越GFW，因此可以保证在中国大陆的可用性，用户未来可以通过vfs-tracker.cn访问。

* 由于合规要求进行ICP和公安备案，目前还在等待审核，预计会在未来几个星期内上线。

* 如果你所在地区可以正常使用vfs-tracker.app，或者你可以通过一些第三方服务访问国际互联网，并且不希望使用一个经过备案且接受监管的版本的话，也可以继续使用国际版，国际版和中国大陆版将会实现数据互通。

---

## 【🤖嗓音数据解读助手RAG】

* 目前的嗓音数据解读助手使用的还是一个很长的prompt，说实话这不是什么太好的办法，一来我们不能建立一个很大的知识库，二来目前的token消耗量非常大

* 如果用户继续增长，AI功能将有可能因为达到日上限而不可用，在一天中较晚访问的用户也许就得不到AI的解读了

* 目前计划是引入RAG，这样可以使得知识库变得更容易扩建，也使得AI可以更好地帮助用户提出建议

---

## 【⌛性能优化】

* 有些用户可能已经发现，每次打开VFS Tracker时都有一个很漫长的“加载用户信息”的过程，这是因为VFS Tracer需要从先根据本地的jwt进行用户认证，然后从Cognito和DynamoDB拉取用户信息，之后才能决定渲染路由。

* 这是一个显著的性能瓶颈，特别是对于想要立刻进行一次快速嗓音测试的用户而言，这是很漫长的等待

* 我们计划利用jwt可以快速验签的特性，将更多的数据写入jwt，并且把一部分数据改为分步加载。这样就可以极大地缩短用户从访问VFS Tracker到可以使用基本功能所需要的时间。

---



> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！
