> 2025年11月16日更新

🎵 我们排期了很长时间的VFS效果预览功能来了！目前这个功能还比较naive，我们非常希望能得到你的建议！

---

## 【🎛️ 三种算法，任君选择】

* **RubberBand (专业级)**：来自音乐制作领域的业界标准库，采用 WebAssembly 版本在浏览器中高速运行。这是录音棚里用来修音高的那种级别！（目前还不是。因为算法的调试还不足）
* **WORLD Vocoder (高保真)**：日本 Morise 博士开发的 WORLD 声码器，在语音合成领域享有盛誉。它能精确分析和重建语音的基频、频谱包络和非周期性成分。
* **TD-PSOLA (轻量级)**：我们自己实现的时域音高同步重叠相加算法，轻巧快速，适合快速预览。

---

## 【🎯 对比播放，一目了然】

* 处理后的音频会分别保存三个版本，你可以随时切换播放对比
* 直观的音高变化显示：`143 Hz → 193 Hz (+50 Hz)`

---

> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 如果可以的话，把VFS Tracker介绍给别人吧！有更多的用户就意味着有更多的数据！
> 
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！

---

> 2025年11月11日更新

今年的双十一各位有买到什么喜欢的东西吗？有成功脱单吗？

反正我是既没有买到什么也没有成功脱单，非常失败了属于是。

虽然我很长时间没有在Github上面发布新的版本了，但我真的不是什么也没做！准确来说，我正在解决以前的屎山问题。过去一个月里，我完成了50多个commit的基础设施重构工作，虽然这些改进对用户来说是"看不见"的，但它们为未来的功能开发奠定了坚实的基础。

嗯，虽然其实只是我被毕业论文和面试疯狂双杀了。

---

## 【🏗️ 建立完整的测试体系】

* 实现了**三层防御体系**的测试架构：单元测试(Unit)、集成测试(Integration)和契约测试(Contract)，总计1056个测试用例，**100%通过率**，代码覆盖率达到52.62%
* 技术栈全面升级：采用Vitest作为测试运行器、React Testing Library用于组件测试、MSW(Mock Service Worker)实现网络级请求拦截
* 新增端到端(E2E)测试框架：基于Playwright搭建了6个完整的测试套件，覆盖67+测试场景，包括用户认证、事件管理、附件功能等核心流程
* 测试质量全面提升：修复了所有不稳定的测试、移除了硬编码的setTimeout、改用waitFor进行异步断言，确保测试的可靠性和可维护性

---

## 【📋 建立可执行的数据契约】

* 使用Joi建立了完整的Schema体系，覆盖User、Profile、Event(所有类型)、API Responses等所有数据结构
* Schema作为**单一真实来源**(Single Source of Truth)，确保Mock数据和真实API响应100%一致
* 实现了自动化的数据验证：所有API响应都会经过Schema验证，及时发现数据结构不匹配的问题
* 创建了完整的测试fixtures库：为complete-profile、minimal-profile、self-test、surgery等场景提供标准化的测试数据

---

## 【🚫 彻底废除运行时开发模式】

* 还记得上一个版本在页面底部的"生产模式"小绿灯吗？如果有人尝试clone过这个项目并在本地dev运行，就会发现VFS Tracker的另一面——开发模式
* 开发模式原本是为了快速验证前端设计而做出来的，但是随着项目规模的逐渐增加，对齐开发模式和生产模式的成本已经开始快速增加到难以负担的程度
* 现在我们已经**彻底废弃了运行时开发模式**，移除了所有`isProductionReady`和`globalIsProductionReady`相关代码，统一使用生产模式逻辑
* 所有的开发调试需求转向MSW mock server，既保证了开发效率，又避免了双重维护的成本

---

## 【📝 增加开源许可证】

* 作为一个开源项目，VFS Tracker居然到现在为止都没有一个许可证。这实在是不应该
* 我们现在对VFS Tracker通过**CC BY-NC-SA 4.0**协议授权，明确了使用条款：
  - ✅ 允许自由使用、修改和分享
  - ✅ 要求署名(Attribution)
  - ❌ 禁止商业使用(NonCommercial)
  - ✅ 衍生作品必须使用相同许可证(ShareAlike)
* 任何想要在现有代码基础上进一步开发的人现在有了法律依据，可以放心进行了

---

## 【🔧 代码质量的全面提升】

* 修复了全局污染问题：EventManager的实例不再泄漏到全局作用域
* 改进了错误处理：统一了ApiError和AppError的使用方式，建立了完整的错误处理规范(见`docs/error-handling-guide.md`)
* 测试稳定性优化：移除了所有不可靠的测试实践(如硬编码setTimeout、console.log断言等)
* 环境变量验证增强：在Amplify配置前验证所有必需的AWS环境变量，缺失时显示清晰的错误信息

---

## 【🎭 端到端测试框架搭建】

* 基于Playwright搭建了完整的E2E测试基础设施
* 添加了测试音频fixtures和详细的README文档，方便后续扩展

---

## 【📚 文档与规范的完善】

* 新增**AGENTS.md**: 为AI编程助手提供完整的项目约定和开发指南
* 更新**TESTING_GUIDE.md**: 详细说明测试编写规范、AAA模式、以及常见陷阱
* 新增**TESTING_ARCHITECTURE.md**: 阐述三层防御体系和Schema驱动开发的完整理念
* 新增**CONTRACT_TEST_ENVIRONMENT.md**: 说明契约测试的环境配置(重要：包含真实测试账户信息)

---

## 【💭 写在最后】

这次更新虽然没有添加新的用户可见功能，但这些"看不见"的基础设施工作是非常重要的：

* **测试体系**让我们可以放心地重构代码，不用担心破坏现有功能
* **数据契约**确保了前后端的数据格式始终一致，减少了因数据格式不匹配导致的bug
* **移除开发模式**简化了代码逻辑，让维护成本大幅降低
* **完善的文档**让新的贡献者能够快速了解项目规范

正如软件工程中常说的："偿还技术债务虽然不会立即带来新功能，但它会让未来的功能开发变得更快、更稳定"。

接下来我会继续优化CI/CD流程，将E2E测试集成到持续集成中，并开始着手实现一些新的功能特性！

---

> 2025年10月5日更新

全新的 Hz-音符转换工具已经上线，同时桌面端顶栏的“工具”菜单也正式与公共仪表板合并。

---

## 【🎼 新增 Hz-音符转换工具】

* 任何访客都可以直接使用 Hz ↔ 音名转换功能，并在 88 键钢琴上看到粉色高亮的结果。
* 在线状态自动加载钢琴 soundfont，离线状态回退为振荡器播放，兼容现有的 service worker。
* 针对手机等窄屏设备优化了横向滑动体验，保证随时都能找到目标琴键。

---

## 【🧰 顶栏入口调整】

* 电脑端顶栏新增“工具”下拉菜单，整合公共仪表板与 Hz-音符转换器等实用功能。
* 侧栏与「我的页面」同步增加了新的入口，方便快速跳转到转换工具。
* 实际上顶栏的下拉菜单是完全重构了！再也不会出现旧版本的抖动了！

---

> 2025年10月3日更新

今天的更新是一些屎山代码的处理。

---

## 【🧭 增加了到公共仪表板的NavLink】

* 现在登录后也会在上方看到公共仪表板的NavLink了。
* 对于已登录用户而言，不需要退出也能找到前往公共仪表板的按钮了。

---

## 【⚙️ 资料完善入口统一】

* 现在点击顶部横幅会直接进入引导式向导，不再弹出旧版的单页表单。
* 删除了重复的 ProfileSetup 组件和模态窗口，避免用户在不同入口看到不同界面。
* 向导现在使用与账号上下文一致的 `completeProfileSetup()` 来提交资料。
* 跳过功能暂时有问题，建议不要这么做。

---

## 【🧪 错误处理测试全面上线｜Error handling tests are now comprehensive】

* 新增 `node --test` 脚本自动跑通核心错误类型，覆盖 ApiError/AppError 及上传异常的关键场景。
* 测试同时验证上下文合并、请求 ID 捕获等细节，确保开发模式下的回退逻辑同样安全。

---

## 【📘 文档同步更新】

* README 与架构文档同步说明：缺少任一 AWS 关键环境变量都会被判定为开发模式。
* 记录必需变量列表（含 API Endpoint 与 S3 Bucket），方便部署时一次性核对。
* 新增根目录 AGENTS.md，写明“配置完整性”才会触发生产模式。
* 不再使用TODOList管理待办事项，转向issues。


---

> 2025年10月1日更新

🎉国庆快乐！我为VFS Tracker安排了一次小而重要的调整，让侧栏体验更加专注。

---

## 【🎯 侧栏入口更精简】

* 关闭了“公告”和“文档中心”两个入口，让日常使用中最常用的功能排在显眼位置。
* 精简后的导航更聚焦在录音、测试和个人资料等核心任务，减少首次打开时的信息量。
* 如果需要查阅公告或文档，也可以通过顶部导航或收藏的直达链接访问，不会受到影响。

---

## 【🧭 更新记录更好找】

* 保留了公告内容在“更新记录”中持续发布，你仍然可以在这里快速了解最新动态。
* 这一调整也让PWA的离线菜单更干净，方便你在断网时迅速找到真正可用的功能。

---

> 2025年9月30日更新

🚀我对VFS Tracker进行了一次重要的小修复，解决了PWA更新后页面可能重复刷新的问题！

---

## 【🔄更友好的PWA更新提示】

* 之前当Service Worker有新版本时，页面可能会自动刷新两次，让人有些摸不着头脑。
* 现在我们加入了一个更新横幅，当检测到新版本时会提示你选择刷新或稍后再说。
* 这样你可以在合适的时间刷新，不会被突如其来的自动刷新打断使用。

---

## 【🧭 首次登录引导更聪明】

* 收紧了“资料已完善”的判定条件，现在只有填写了真实姓名并确认隐私设置的新用户才会被认定为完成引导。
* 登录后会优先检查资料状态，只有在在线且确实需要完善资料时才会自动进入向导，避免离线情况下被强制跳转。
* 我们还把最近一次成功拉取的资料缓存到了本地，断网时会优先使用缓存内容而不是直接判定为未完善。

---

## 【📴 离线体验升级】

* 资料完善向导现在支持离线暂存，断网时点击完成会先保存到本地，等网络恢复后你可以再同步。
* 向导也新增了“先跳过”按钮，保证在离线场景下不会卡住。
* 侧栏会根据登录与否、在线状态自动隐藏需要认证或不适合离线访问的功能，让你在离线时只看到真正可用的入口。
* Service Worker 增强了脚本/样式/字体的缓存策略，公开页面访问过一次后离线再打开也能顺利加载。

---

> 2025年9月29日更新 （国庆节快乐特别版）

🌠我对VFS Tracker进行了一些更新！现在VFS Tracker又有了一些进步！

---

## 【☁️接入阿里云ESA】

* 今天凌晨我得到通知，ICP备案批准了！🎉于是VFS Tracker得以正式接入ESA（也就是说，中国大陆版本已经正式上线）

* ESA可以合法地穿越GFW，现在中国大陆所有地区的用户应该都可以正常使用了！（指中国大陆版）

* 如果在中国大陆使用vfs-tracker.app地址访问有问题，那么就改用vfs-tracker.cn吧！

---

## 【🛫大幅加快了页面加载速度】

* 原先的二重串行用户数据阻塞请求被改为了并行非阻塞请求，用户将不会再长时间看到烦人的“正在加载用户数据”界面。

* 我们还启用了缓存，这将会进一步加快用户的加载速度。

* 现在你应该可以很快地进入VFS Tracker的主界面，而无需进行烦人的长时间等待！

* 目前这一功能仍处于实验性阶段，虽然现阶段的测试功能正常，但是仍然存在出现脏读等问题的可能性。如果你发现数据有错乱，请清除缓存再试一次。（电脑上只需要同时按下 Ctrl/Cmd + Shift + R 即可）

---

## 【🌐PWA现在可以离线运行部分功能】

* 原先的PWA实际上根本没有一个真正的Service Worker，因此断网下将会彻底无法使用

* 新版本的Service Worker实现了一部分非联网功能，允许PWA用户在断网状态下使用“音阶练习”和“快速基频测试”功能。

* 一部分需要联网的feature不可使用，例如更好的钢琴音色、AI荐歌等。

* 如果你错过了第一次访问VFS Tracker时弹出的安装窗口，现在我们制作了一个安装按钮，你可以随时安装这个PWA到手机中。

* 这样子你就可以随时在不联网的情况下，进行一次无需等待的快速基频测试。我们希望这能让VFS Tracker更好地取代你手里的Voice Tools。

---

## 【📱手机端布局的改进】

* 原先VFS Tracker的布局完全没有为手机优化，这导致页面在手机上看起来总是很奇怪。

* 我们现在更新了顶栏的布局，把一部分功能收入了侧栏。这样顶栏将不会那么拥挤，布局也将会看起来正常许多！

---

## 【✅合规管理】

* 我们在中国大陆版本的下方加入了ICP备案信息

* 国际版增加了一个弹窗，如果你位于中国大陆地区并且感受到显著的访问速度问题，可以通过这个弹窗一键跳转中国大陆版

* 中国大陆版和国际版已经实现了数据互通

> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 如果可以的话，把VFS Tracker介绍给别人吧！有更多的用户就意味着有更多的数据！
> 
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！

---

> 2025年9月26日更新

🎉我刚刚对VFS Tracker进行了一些重大更新！相信这些更新将会大幅提升用户体验！

---

## 【🖥️现在VFS Tracker已经全量接入Cloudflare CDN】

* 不仅是页面本身，API和对象存储现在也会就近进入Cloudflare的边缘节点，然后通过高速CDN网络抵达服务器。

* 尽管Cloudflare CDN仍然属于跨境网络，但是其网络质量远好于直接连接位于us-east-1的访问点。

* api访问点由以前复杂的aws默认地址变成了api.vfs-tracker.app，对象存储访问点变成了storage.vfs-tracker.app，看起来变优雅了

* 现在在中国大陆地区的可用性应该得到了提升，除了部分存在“墙中墙”的地区，应该都可以通过vfs-tracker.app正常使用了。

---

## 【📊共振峰分析的史诗级加强】

* 原先的共振峰分析逻辑只会分析最高音和最低音，现在加入了对持续元音的分析。

* 实现了更加稳健的共振峰分析算法，除了会对每一帧实行置信度分析以防止噪声和无效片段干扰外，还会通过track和交叉验证来避免错误地识别到谐波，或者在某一共振峰缺失时错误地拿下一个共振峰顶上。

* 目前VFS Tracker的共振峰识别应该是所有开放产品中最准确的了！（其实也是其他的产品太少了以至于我可以挨个测试一遍）

---

## 【🐞一些bug的修复】

* 音域分析现在会合并分析你的多次测试，真的不会放过你的最佳表现了！

* MPT测试的录音文件选择bug已经修复，目前会选择真·发生时最长的文件，而不是录音时长最长的

---

## 【⭐一些其他的用户体验提升】

* 完整声音测试的主观量表允许跳过了，如果你不是很想写量表的话，现在可以跳过它

---

* 📑此外，我们还有一些接下来的开发计划 →

---

## 【☁️接入阿里云边缘安全加速ESA】

* Cloudflare仍然属于跨境访问，不能100%确保可用性，因此我们计划利用ESA再推出一个中国大陆版。

* ESA是合规的跨境加速器，可以合法穿越GFW，因此可以保证在中国大陆的可用性，用户未来可以通过vfs-tracker.cn访问。

* 由于合规要求进行ICP和公安备案，目前还在等待审核，预计会在未来几个星期内上线。

* 如果你所在地区可以正常使用vfs-tracker.app，或者你可以通过一些第三方服务访问国际互联网，并且不希望使用一个经过备案且接受监管的版本的话，也可以继续使用国际版，国际版和中国大陆版将会实现数据互通。

---

## 【🤖嗓音数据解读助手RAG】

* 目前的嗓音数据解读助手使用的还是一个很长的prompt，说实话这不是什么太好的办法，一来我们不能建立一个很大的知识库，二来目前的token消耗量非常大

* 如果用户继续增长，AI功能将有可能因为达到日上限而不可用，在一天中较晚访问的用户也许就得不到AI的解读了

* 目前计划是引入RAG，这样可以使得知识库变得更容易扩建，也使得AI可以更好地帮助用户提出建议

---

## 【⌛性能优化】

* 有些用户可能已经发现，每次打开VFS Tracker时都有一个很漫长的“加载用户信息”的过程，这是因为VFS Tracer需要从先根据本地的jwt进行用户认证，然后从Cognito和DynamoDB拉取用户信息，之后才能决定渲染路由。

* 这是一个显著的性能瓶颈，特别是对于想要立刻进行一次快速嗓音测试的用户而言，这是很漫长的等待

* 我们计划利用jwt可以快速验签的特性，将更多的数据写入jwt，并且把一部分数据改为分步加载。这样就可以极大地缩短用户从访问VFS Tracker到可以使用基本功能所需要的时间。

---



> 如果你还有其他的期望，请提出来告诉丽塔，她会尽可能实现所有的合理要求。
>
> 如果你觉得VFS Tracker做的不错，请使用VFS Tracker记录下你的VFS前，VFS后的声音，以及VFS这个事件本身，这将会带来很大的帮助。
>
> 最后，要是能在Github给VFS Tracker点一个小星星就太好啦！！